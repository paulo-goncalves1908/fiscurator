## **About the asset**

This asset was developed to work as a Watson Assistant curatorship plataform. Through the collection of its conversation logs, data about its performance is extracted and transformed in high level information aimed at the executive audience. The data includes, for example: number of non contemplated conversations (transfered to a human agent or not), client intension comprehension quality by the Assistant's part, daily conversation volume history, performance over time, among others.

## **Deploying Resources**

This documentation here explains details about the asset operation. To view the doc about how to deploy the resources, [see this guide](https://github.ibm.com/Innovation-Studio-Assets/assistant-curator/tree/master/terraform).

## **Architecture**

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator-arch.png)

This asset is structured in two main parts:

- A [**cloud function**](https://cloud.ibm.com/docs/openwhisk) sequence that acts on the IBM Cloud platform in the chosen time intervals receiving, transforming and storing the assistant's logs;

- A frontend over which a curator can evaluate the conversational assistant's understanding ang visualize an [**executive Dashboard**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-gettingstartedtutorial) generated through the extracted data.

The cloud function sequence communicates with the assistant through the [_listLogs()_](https://cloud.ibm.com/apidocs/assistant-v1?code=node#listlogs) method, available thanks to the Watson Assistant's [API v1](https://cloud.ibm.com/apidocs/assistant-v1). Once it has all the logs, the sequence performs the following tasks:

1. Removes information considered to be the most relevant for the curation task at the **log level**:

   - ID of the user that the assistant was talking to;
   - ID of the conversation to which this log belongs;
   - ID of the log in question;
   - The message sent by the client and the time it was received;
   - The answer given by the assistant and the time it was delivered;
   - The title of the _node_ of the assistant's dialog tree triggered in this transaction;
   - The intentions understood by the assistant in this transaction;
   - The confidence that the assistant has in the intention he has chosen as the main one (numerical value);
   - The entities understood by the assistant in this transaction;

2. Group logs into conversations according to the _conversationID_ it carries and:

   - Classifies whether the means used in the conversation was by telephone or by exchanging messages;
   - Gives the start date and time;
   - Saves its entire duration (in seconds);
   - Saves, if any, the feedback note that the assistant received from the customer;
   - Analyzes and saves whether or not the conversation was transferred to a human attendant;
   - Classifies whether the conversation is relevant based on the existence or not of certain intents in any of the participating logs;
   - Indicates whether this conversation is the customer's first contact with the assistant or not.

3. For phone conversations, it stores data referring to the user's number and IP and also if there were voice interruptions by the customer (customer speaking "on top" of the assistant)

4. For all conversations, it also stores the environment variables generated during the conversation, classifying their data type (Ex.: "string", "object", "boolean", etc.)

5. Once the logs were manipulated in this way, the sequence ends by inserting them into three databases: [ **Cloudant**](https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-client-libraries#client-libraries), [**COS (Cloud Object Storage)**](https://cloud.ibm.com/docs/cloud-object-storage?topic=cloud-object-storage-getting-started-cloud-object-storage) and [**Db2**](https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started)

Through the connection of [**Db2**](https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started), with [**Cognos**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-gettingstartedtutorial), graphics are build from the data stored, generated by the cloud functions.

This graphics are to be consumed over the frontend. The front also counts with a tab dedicated to empower the curator with the capability to evaluate the assistant's understanding with a score. This score - by default ranging from 1 to 5 - is used to validate the quality of the assistant's construction and training, since, by crossing the assistant's confidence in the main intention he understood in the client's sentence with the note attributed by the curator in this same sentence, it is possible to validate the **Efficiency** x **Effectiveness** of the assistant.

Efficiency is understood as "providing broad coverage of the questions" and effectiveness as "providing the right answers".

## **Components**

As seen above, this asset consists of two main parts:

### **Cloud functions sequence**

Comprised of 5 different functions, the sequence is organized so that the output of the first is the input of the next, and so on. They are:

- **create-tables-cf**

  Creates, if necessary, the four tables that are to receive the logs processed in the specified Db2 instance.

- **process-logs-cf**

  Performs log-level information extraction (Step 1 described in the architecture topic)

- **process-conversations-cf**

  Group conversation-level logs and extract conversation-level information (Steps 2 and 3)

- **enrich-cf**

  Consults [**NLU**](https://cloud.ibm.com/docs/natural-language-understanding?topic=natural-language-understanding-getting-started) to extract sentiment from the text, stored in the form numerical values ​​ranging from **-1**, for negative feelings, and **+1**, for positive feelings. In addition, this function extracts the context variables from the conversations (Step 4)

- **insert-logs-cf**

  From the objects generated in the previous functions, in this final step, connection is made with the three databases: [**Cloudant**](https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-ibm-cloud-public), [**COS**](https://cloud.ibm.com/docs/cloud-object-storage?topic=cloud-object-storage-getting-started-cloud-object-storage) and [**Db2**](https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started). In Cloudant and COS the logs are stored in order to keep their backup, in Db2 we have the storage of the relevant information filtered and generated by the functions.

### **Curator Interface**

The curator interface has two functionalities:

- Present a conversation between a customer and the assistant at the conversation level. The curator can then evaluate it's assertiveness with a score (1 - 5);

- Provide an interface for building and consulting interactive dashboards that show the assistant's performance over time.

The curator interface communicates with the Db2 instance through the [**ibm_db**](https://www.npmjs.com/package/ibm_db), package for Node that works as API of the selected Db2 instance.

Having received this data, we have the presentation of the logs, organized in conversations, in the form of a table:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator01.png)

There is also a dedicated tab for searching messages based on the Intents identified in them, which displays all identified intents and a search bar to filter the result:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator02.png)

Communication with the Cognos Embedded instance is also done through its API, which documentation is available at the following links: [**CognosApi Docs**](https://dde-us-south.analytics.ibm.com/daas/jsdoc/cognos/api/CognosApi.html), [**CognosApi File**](https://dde-us-south.analytics.ibm.com/daas/CognosApi.js).

Once the connection is made, a Cognos session is started for the user, who is then able to start viewing the dashboards interface available in the "Cognos" tab of the frontend:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator04.png)

The dashboards, once opened and/or modified can be stored over [**Cloudant**](https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-ibm-cloud-public), so that they are available between accesses.

## **Pre-requisites**

To continue with this documentation, you must have an [**IBM Cloud**](https://cloud.ibm.com/) account.

An instance of Watson Assistant is also required, with an assistant deployed and some conversation logs with it available (by default, assistant logs for Lite and Plus plans are only stored for 30 days).

We also equire instances of [**Cloudant**](https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-ibm-cloud-public), [**COS**](https://cloud.ibm.com/docs/cloud-object-storage?topic=cloud-object-storage-getting-started-cloud-object-storage) and [**Db2**](https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started). It is recommended to deploy all of them on the IBM Cloud itself.

In order to extract sentiment from messages sent by the client, it is also necessary to instantiate the [**NLU**](https://cloud.ibm.com/docs/natural-language-understanding?topic=natural-language-understanding-getting-started) service.

The last service to be instantiated on the IBM Cloud is [**Cognos Embedded**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-gettingstartedtutorial), responsible for the Dashboards to be built and presented on the front.

Knowledge on how to upload code like [**cloud function**](https://cloud.ibm.com/docs/openwhisk) to the IBM Cloud is recommended, but this process will happen automatically via a [**terraform**](https://www.terraform.io/docs).

Finally, please make sure that [**Docker**](https://docs.docker.com/get-docker/) is installed on your machine, as we will need it to load some containers and files.

## **How to perform the deployment**

For documentation on how to deploy this asset, please refer to the following step-by-step guide to automatically instantiate all necessary services: [**terraform**](https://github.ibm.com/Innovation-Studio-Assets/assistant-curator/tree/master/terraform).

## **User Guide**

As mentioned in previous topics, the curator interface is connected to three services:

- [**Db2**](https://cloud.ibm.com/docs/Db2onCloud?topic=Db2onCloud-getting-started), with its 4 tables populated by the cloud functions;

- [**Cognos Embedded**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-gettingstartedtutorial), for the creation and display of dashboards;

- [**Cloudant**](https://cloud.ibm.com/docs/Cloudant?topic=Cloudant-client-libraries#client-libraries), to save changes made to dashboards.

To connect to their respective instances, the credentials for each one of them must be informed by the user through the curator interface. There are two configuration modules to complete:

The first configuration modal refers to the connection with **Db2** to collect data from its log table. It is displayed by clicking on the gear icon located in the upper right corner of the header if the user is in the **home tab** or **intent search tab**:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator03.png)

To fill it, we need the following credentials:

- Db2 **Connection String**:

  Although all the data needed to compose this information is in the service credentials available on the home page of the **Db2** instance on the **IBM Cloud**, it is not formatted correctly. The **Connection String** must be composed in this syntax:

        DATABASE=<your database name>;HOSTNAME=<your hostname>;PORT=<your instance port>;PROTOCOL=TCPIP;UID=<your username>;PWD=<your password>;Security=SSL;

- **Log table name**

  By default, the table name is set to "**logs**"

The second configuration modal concerns the data needed to connect with **Cognos**, with **Db2 through Cognos** and with **Cloudant**, in order to (respectively) **present** , **populate** and **save** dashboards. It is presented by clicking on the same gear icon, once the user is in the **Cognos tab**:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator05.png)

To fill it, we need the following info:

- **Cognos**

  - Cognos access user
  - Cognos access password

        Both these are available in the "service credentials" of your instance's home page in the IBM Cloud, although with different names: The username is defined as "**client_id**" and the password as "**client_secret**".

- **Cloudant**

  - Database name to be consulted

    You can set the name you want, although by default it is expected as: "**dashboards**".

  - Cloudant URL
  - Cloudant apiKey

    Both available on the "service credentials" tab on the instance homepage over IBM Cloud.

- **Db2**

  - modulo.xsd download link

    As explained in the "working with datasource" documentation available at this [**link**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-workingwithdatasources).

  - URL de conexão através do padrão JDBC

    This info can be found in the "service credentials" tab on the instance's home page, although it needs to be formatted. Its syntax should be like the following example:

        jdbc:db2://<your hostname>:<your PORT>/<your database name>:sslConnection=true;

  - JDBC driver class

    Also explained in the "working with datasource" documentation available at this [**link**](https://cloud.ibm.com/docs/cognos-dashboard-embedded?topic=cognos-dashboard-embedded-workingwithdatasources).

  - Schema in which the Db2 tables are saved.

    By default, the Db2 schema is your username in capital letters, unless otherwise specified.

  - Db2 username
  - Db2 password

    Both available under the "service credentials" tab over the service homepage on IBM Cloud.

- **Tables Names**

  In this tab, the names of the four tables saved in Db2 are expected. By default, they are, respectively:

  - **Logs**
  - **Conversations**
  - **Calls**
  - **ContextVariables**

Once the credentials are filled in one first time, it is not necessary to redo it in the other accesses, except in the case of unforeseen.

In the "**Cognos**" tab you have the interactive Dashboard interface. It can be saved on Cloudant so that, in the next access, your local changes are loaded from the database.

To do so, just click on the floppy disk icon which will open two options: **Save** or **Search** a dashboard:

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator06.png)

![img](https://portal-de-demos-imgs.s3.us-south.cloud-object-storage.appdomain.cloud/assistant-curator07.png)

The given name entered to save the dashboard will be set as default, so that the next time the Cognos tab is accessed, this will be the dashboard initially displayed.

If another dashboard is loaded using the **Load** option, this new one will be set as default, without the previously saved one being deleted.

In case there is no dashboard saved in the consulted **Cloudant**, a standard dashboard with visualizations already available will be initialized and displayed.
